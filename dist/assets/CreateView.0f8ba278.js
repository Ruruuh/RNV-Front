import{z as Q,_ as R,d as S,s as M,m as W,o as n,c as d,a as e,t as q,q as s,i as U,v as B,A as C,B as G,j as m,F as H,p as V,e as z,l as L,r as $,b as D,w as T,C as Y,x as A,f as O,T as X,g as Z,u as ee,n as te,D as ae,E as se,G as oe,y as ne}from"./index.af7eaf7e.js";import{n as x}from"./nprogress.af06dfa6.js";const F=Q({id:"create",state:()=>({purpose:"",office:"",department:"",isOfficeEmpty:!1,isDepartmentEmpty:!1,isDateEmpty:!1,isTotalBelowMin:!1,isNatureEmpty:!1,isUploadEmpty:!1,isModalDisplayed:!1,isAmountUnderMin:!1,reimbursements:null,reimbursementDate:"",reimbursementAmount:0,reimbursementNature:"",reimbursementTotal:0,modifyType:"add",indexToUpdate:0,files:null}),actions:{updateIsModalDisplayed(){this.isModalDisplayed=!this.isModalDisplayed},updateIsOfficeEmpty(){this.office===""?this.isOfficeEmpty=!0:this.isOfficeEmpty=!1},updateIsDepartmentEmpty(){this.department===""?this.isDepartmentEmpty=!0:this.isDepartmentEmpty=!1},updateIsTotalBelowMin(){this.reimbursementTotal<500?this.isTotalBelowMin=!0:this.isTotalBelowMin=!1},updateIsDateEmpty(){this.reimbursementDate===""?this.isDateEmpty=!0:this.isDateEmpty=!1},updateIsAmountUnderMin(){this.reimbursementAmount<300?this.isAmountUnderMin=!0:this.isAmountUnderMin=!1},updateIsNatureEmpty(){this.reimbursementNature===""?this.isNatureEmpty=!0:this.isNatureEmpty=!1},updateIsUploadEmpty(){this.files?this.isUploadEmpty=!1:this.isUploadEmpty=!0},updateRowNumbers(){let o=1;this.reimbursements&&this.reimbursements.forEach(t=>{t.rowNumber=o,o+=1})},updateReimbursementTotal(){const o=[];this.reimbursements&&this.reimbursements.forEach(a=>{o.push(a.expenseAmount)});const t=o.reduce((a,c)=>a+c,0);this.reimbursementTotal=t}}});const N=o=>(V("data-v-04978c55"),o=o(),z(),o),ie=N(()=>e("div",{class:"create__header"},"Create Ticket",-1)),re=N(()=>e("div",{class:"create__divider"},null,-1)),le={class:"create__ticket ticket"},de={class:"ticket__row"},ue=N(()=>e("div",{class:"ticket__label"},"Date",-1)),ce={class:"ticket__date"},me={class:"ticket__row"},pe=N(()=>e("div",{class:"ticket__label"},"Purpose",-1)),_e={class:"ticket__row"},ve=N(()=>e("div",{class:"ticket__label"},"Office",-1)),fe=L('<option value="" data-v-04978c55>-- Please choose an office --</option><option value="FEU Tech" data-v-04978c55>FEU Tech</option><option value="FEU Diliman" data-v-04978c55>FEU Diliman</option><option value="FEU Makati" data-v-04978c55>FEU Makati</option><option value="FEU Cavite" data-v-04978c55>FEU Cavite</option><option value="FEU High School" data-v-04978c55>FEU High School</option><option value="FEU Alabang" data-v-04978c55>FEU Alabang</option><option value="FEU Roosevelt" data-v-04978c55>FEU Roosevelt</option>',8),he=[fe],be={class:"ticket__row"},ye=N(()=>e("div",{class:"ticket__label"},"Department",-1)),ge=L('<option value="" data-v-04978c55>-- Please choose a department --</option><option value="Multimedia Arts" data-v-04978c55>Multimedia Arts</option><option value="Computer Science" data-v-04978c55>Computer Science</option><option value="Information Technology" data-v-04978c55>Information Technology</option><option value="Computer Engineering" data-v-04978c55>Computer Engineering</option><option value="Mechanical Engineering" data-v-04978c55>Mechanical Engineering</option><option value="Civil Engineering" data-v-04978c55>Civil Engineering</option><option value="Electronics and Electrical Engineering" data-v-04978c55>Electronics and Electrical Engineering</option><option value="Mathematics and Physical Sciences" data-v-04978c55>Mathematics and Physical Sciences</option><option value="Humanities, Social Sciences, and Communication" data-v-04978c55>Humanities, Social Sciences, and Communication</option>',10),Ee=[ge],we={key:0,class:"error"},ke={key:1,class:"error"},xe=S({__name:"CreateInfo",setup(o){const t=F(),{purpose:a,office:c,department:y,isOfficeEmpty:b,isDepartmentEmpty:p}=M(t),r=W(()=>new Date().toISOString().slice(0,10));return(_,i)=>(n(),d(H,null,[ie,re,e("div",le,[e("div",de,[ue,e("div",ce,q(s(r)),1)]),e("div",me,[pe,U(e("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=g=>C(a)?a.value=g:null),required:""},null,512),[[B,s(a)]])]),e("div",_e,[ve,U(e("select",{class:"ticket__office","onUpdate:modelValue":i[1]||(i[1]=g=>C(c)?c.value=g:null)},he,512),[[G,s(c)]])]),e("div",be,[ye,U(e("select",{class:"ticket__department","onUpdate:modelValue":i[2]||(i[2]=g=>C(y)?y.value=g:null)},Ee,512),[[G,s(y)]])]),s(b)?(n(),d("div",we,"Please choose an office.")):m("",!0),s(p)?(n(),d("div",ke,"Please choose an department.")):m("",!0)])],64))}});var Ie=R(xe,[["__scopeId","data-v-04978c55"]]);const J=o=>(V("data-v-9cc5b0f6"),o=o(),z(),o),De={class:"reimbursement"},Ue={class:"reimbursement__header"},Ce=J(()=>e("div",{class:"reimbursement__title"},"Reimbursement",-1)),Me=O("Add Reimbursement"),Ne=J(()=>e("div",{class:"reimbursement__table"},[e("div",{class:"reimbursement__column-headers"},[e("div",null,"Row #"),e("div",null,"Expense Date"),e("div",null,"Amount"),e("div",null,"Nature of Expenditure"),e("div",null,"Actions")])],-1)),Ae={class:"reimbursement__total"},Te={key:0,class:"error"},$e=S({__name:"CreateReimbursement",setup(o){const t=F(),{isTotalBelowMin:a,reimbursements:c,reimbursementDate:y,reimbursementAmount:b,reimbursementNature:p,reimbursementTotal:r,indexToUpdate:_,modifyType:i}=M(t);function g(E){let f=null;c.value&&(f=c.value[E-1]),f&&(y.value=f.expenseDate,b.value=f.expenseAmount,p.value=f.expenseNature),_.value=E-1,i.value="update",t.updateIsModalDisplayed()}function v(E){c.value&&c.value.splice(E-1,1),t.updateRowNumbers(),t.updateReimbursementTotal()}return(E,f)=>{const I=$("base-button"),k=$("base-row");return n(),d("div",De,[e("div",Ue,[Ce,D(I,{onClick:s(t).updateIsModalDisplayed,mode:"dark"},{default:T(()=>[Me]),_:1},8,["onClick"])]),Ne,(n(!0),d(H,null,Y(s(c),l=>(n(),A(k,{onDeleteRow:f[0]||(f[0]=u=>v(u)),onEditRow:f[1]||(f[1]=u=>g(u)),class:"reimbursement__row",key:l.rowNumber,rowNumber:l.rowNumber,date:l.expenseDate,amount:l.expenseAmount,nature:l.expenseNature,mode:"create"},null,8,["rowNumber","date","amount","nature"]))),128)),e("div",Ae,"Total Amount: "+q(s(r)),1),s(a)?(n(),d("div",Te,"Total should be 500 at minimum. Please add reimbursement item.")):m("",!0)])}}});var Re=R($e,[["__scopeId","data-v-9cc5b0f6"]]);const Se=o=>(V("data-v-4b0f2866"),o=o(),z(),o),Fe={class:"uploads"},Pe=Se(()=>e("div",{class:"uploads__header"},"Upload Receipt/Prescription",-1)),Be={for:"uploads__input",class:"uploads__action"},Ve={key:0,class:"uploads__icon"},ze={key:1},Oe={key:2},je={key:3},qe={class:"uploads__filename"},He={key:0,class:"error"},Ge=S({__name:"CreateUploads",setup(o){const t=F(),{files:a,isUploadEmpty:c}=M(t);function y(b){const r=b.currentTarget.files;r&&(a.value=r)}return(b,p)=>(n(),d("div",Fe,[Pe,e("label",Be,[s(a)?m("",!0):(n(),d("div",Ve)),s(a)?m("",!0):(n(),d("div",ze,"Click here to choose.")),s(a)?m("",!0):(n(),d("div",Oe,"You can choose more than one at the same time.")),s(a)?(n(),d("div",je,"Click here again to change")):m("",!0),s(a)?(n(!0),d(H,{key:4},Y(s(a),r=>(n(),d("div",qe,q(r.name),1))),256)):m("",!0),e("input",{type:"file",id:"uploads__input",onChange:p[0]||(p[0]=r=>y(r)),multiple:""},null,32)]),s(c)?(n(),d("div",He,"No uploads found. Please upload receipt/prescription.")):m("",!0)]))}});var Le=R(Ge,[["__scopeId","data-v-4b0f2866"]]);const j=o=>(V("data-v-1000b3c8"),o=o(),z(),o),Ye={class:"modal__header"},Je={key:0,class:"modal__title"},Ke={key:1,class:"modal__title"},Qe=j(()=>e("div",{class:"modal__divider"},null,-1)),We={class:"modal__input"},Xe=j(()=>e("div",{class:"modal__label"},"Expenditure Date",-1)),Ze={key:0,class:"error"},et={class:"modal__input"},tt=j(()=>e("div",{class:"modal__label"},"Amount",-1)),at={key:1,class:"error"},st={class:"modal__input"},ot=j(()=>e("div",{class:"modal__label"},"Nature of Expenditure",-1)),nt={key:2,class:"error"},it=O("Add"),rt=O("Update"),lt=S({__name:"CreateModal",setup(o){const t=F(),{isModalDisplayed:a,isDateEmpty:c,isAmountUnderMin:y,isNatureEmpty:b,reimbursements:p,reimbursementDate:r,reimbursementAmount:_,reimbursementNature:i,indexToUpdate:g,modifyType:v}=M(t);function E(){r.value="",_.value=0,i.value=""}function f(){const l={expenseDate:r.value,expenseAmount:_.value,expenseNature:i.value,rowNumber:null};if(r.value===""){t.updateIsDateEmpty();return}else t.updateIsDateEmpty();if(_.value<300){t.updateIsAmountUnderMin();return}else t.updateIsAmountUnderMin();if(i.value===""){t.updateIsNatureEmpty();return}else t.updateIsNatureEmpty();p.value?p.value.push(l):p.value=[l],t.updateIsModalDisplayed(),t.updateRowNumbers(),t.updateReimbursementTotal(),E()}function I(){const l={expenseDate:r.value,expenseAmount:_.value,expenseNature:i.value,rowNumber:null};if(r.value===""){t.updateIsDateEmpty();return}else t.updateIsDateEmpty();if(_.value<300){t.updateIsAmountUnderMin();return}else t.updateIsAmountUnderMin();if(i.value===""){t.updateIsNatureEmpty();return}else t.updateIsNatureEmpty();const u=g.value;p.value&&(p.value[u]=l),t.updateIsModalDisplayed(),t.updateRowNumbers(),t.updateReimbursementTotal(),v.value="add",E()}function k(){t.updateIsModalDisplayed(),v.value="add",E()}return(l,u)=>{const P=$("base-button"),h=$("base-modal");return n(),A(X,{to:"#app"},[s(a)?(n(),A(h,{key:0},{default:T(()=>[e("div",Ye,[s(v)==="add"?(n(),d("div",Je,"New Reimbursement")):m("",!0),s(v)==="update"?(n(),d("div",Ke,"Update Reimbursement")):m("",!0),e("div",{onClick:k,class:"modal__close"})]),Qe,e("div",We,[Xe,U(e("input",{type:"date","onUpdate:modelValue":u[0]||(u[0]=w=>C(r)?r.value=w:null)},null,512),[[B,s(r)]])]),s(c)?(n(),d("div",Ze,"Please choose a date.")):m("",!0),e("div",et,[tt,U(e("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=w=>C(_)?_.value=w:null)},null,512),[[B,s(_)]])]),s(y)?(n(),d("div",at,"Amount cannot be below 300. Please try again.")):m("",!0),e("div",st,[ot,U(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=w=>C(i)?i.value=w:null)},null,512),[[B,s(i)]])]),s(b)?(n(),d("div",nt,"Please enter nature of expense.")):m("",!0),s(v)==="add"?(n(),A(P,{key:3,onClick:f,mode:"dark",class:"modal__add"},{default:T(()=>[it]),_:1})):m("",!0),s(v)==="update"?(n(),A(P,{key:4,onClick:I,mode:"dark",class:"modal__add"},{default:T(()=>[rt]),_:1})):m("",!0)]),_:1})):m("",!0)])}}});var dt=R(lt,[["__scopeId","data-v-1000b3c8"]]);const ut={class:"create"},ct=O("Create"),mt=S({__name:"CreateView",setup(o){const t=Z(),a=F(),c=ee(),{userId:y,token:b}=M(t),{purpose:p,office:r,department:_,reimbursements:i,reimbursementTotal:g,files:v}=M(a);async function E(){const k=await ne("/api/tickets",b.value),l=[];return k.forEach(u=>{l.push(u.crf)}),l.length===0?1e3:Math.max(...l)+1}async function f(){if(x.start(),r.value===""){a.updateIsOfficeEmpty(),x.done();return}else a.updateIsOfficeEmpty();if(_.value===""){a.updateIsDepartmentEmpty(),x.done();return}else a.updateIsDepartmentEmpty();if(g.value<500){a.updateIsTotalBelowMin(),x.done();return}else a.updateIsTotalBelowMin();if(v.value)a.updateIsUploadEmpty();else{a.updateIsUploadEmpty(),x.done();return}const I=await E();let k=[];if(i.value)for(let h=0;h<i.value.length;h++){const w={expenseDate:i.value[h].expenseDate,expenseAmount:i.value[h].expenseAmount,expenseNature:i.value[h].expenseNature,approved:!1,rowNumber:null};k.push(w)}let l=[];if(v.value)for(let h=0;h<v.value.length;h++)l.push({link:"http://localhost:3333/uploads/"+v.value[h].name});const u="/api/tickets",P={creatorId:y.value,crf:I,purpose:p.value,office:r.value,department:_.value,actionBy:"director",status:"Pending Director Action",reimbursements:k,images:l};if(await se(u,b.value,P),v.value){const h="/api/upload",w=new FormData;Array.from(v.value).forEach(K=>{w.append("uploads",K)}),await oe(h,b.value,w)}p.value="",r.value="",_.value="",i.value=null,v.value=null,x.done(),c.push("/overview/pending")}return te(()=>{x.start()}),ae(()=>{x.done()}),(I,k)=>{const l=$("base-button");return n(),d("section",ut,[D(Ie),D(Re),D(Le),D(dt),D(l,{onClick:f,mode:"dark"},{default:T(()=>[ct]),_:1})])}}});var vt=R(mt,[["__scopeId","data-v-800d711e"]]);export{vt as default};
